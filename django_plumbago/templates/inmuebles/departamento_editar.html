{% extends "base.html" %}
{% block title %}
Departamento crear
{% endblock%}
{% block style %}
<link href="{{ STATIC_PREFIX }}assets/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet" type="text/css"/>
<link href="{{ STATIC_PREFIX }}assets/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css"/>
{% endblock%}
{% block body %}
<div class="page-content">
  <!-- BEGIN PAGE HEADER-->
  <div class="page-bar">
    <ul class="page-breadcrumb">
      <li>
        <a href="index.html">Home</a>
        <i class="fa fa-circle"></i>
      </li>
      <li>
        <a href="index.html">Inmuebles</a>
        <i class="fa fa-circle"></i>
      </li>
      <li>
         <span>Departamento</span>
      </li>
    </ul>
  </div>
  <h3 class="page-title">
  INMUEBLES
  </h3>
  <!-- BEGIN MODAL RESPONSIVE -->
  <div id="modal_condomino_editar" class="modal fade" tabindex="-1" data-width="760">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Editar nuevo condómino</h4>
    </div>
    <!-- BEGIN FORM-->
    <form action="{% url 'vista_editar_departamento' departamento.id %}" class="horizontal-form"  method="POST" >
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <div class="portlet-body form">
              <div class="alert alert-danger display-hide" style="display: none;">
                <button class="close" data-close="alert"></button> Tienes algunos errores. 
              </div>
              <div class="alert alert-success display-hide" style="display: none;">
                  <button class="close" data-close="alert"></button> Your form validation is successful! 
              </div>
              {% csrf_token %}
              <input type="hidden" name="editar_condomino_id" value="{{request.GET.editar_condomino_id }}">
              <div class="row ">
                {% for field in user_editar_form %}
                <div class="col-md-6">
                  <div class="form-group {% if field.errors %}has-error{% endif %}">
                    <label class="control-label">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label><br>
                    {{ field }}
                    <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                  </div>
                </div>
                <!--/span-->
                {% endfor %}
              </div>
              <h3>Datos del usuario</h3><hr>
              <div class="row ">
                {% for field in user_profile_editar_form %}
                <div class="col-md-6">
                  <div class="form-group {% if field.errors %}has-error{% endif %}">
                    <label class="control-label">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                    {{ field }}
                    <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                  </div>
                </div>
                <!--/span-->
                {% endfor %}
              </div>
              <!--/row-->
              <h3>Propiedades del usuario</h3><hr>
                {% for field in usuario_departamento_condomino_editar_form %}
                {% if not forloop.counter|divisibleby:2 %}
                <div class="row">
                    {% endif %}
                  <div class="col-md-6">
                    <div class="form-group {% if field.errors %}has-error{% endif %}">
                      <label class="control-label col-md-5">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                      <div class="col-md-7">
                        {{ field }}
                       <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                      </div>
                    </div>
                  </div>
                  <!--/span-->
                    {% if forloop.counter|divisibleby:2 or forloop.last %}
                </div>
                    {% endif %}
                {% endfor %}
              <!--/row-->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-outline dark">Cerrar</button>
        <button type="submit" class="btn green">Guardar</button>
      </div>
    </form>
    <!-- END FORM-->
  </div>
  <!-- END MODAL RESPONSIVE -->
  <!-- BEGIN MODAL RESPONSIVE -->
  <div id="modal_condomino" class="modal fade" tabindex="-1" data-width="760">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Añadir nuevo condómino</h4>
    </div>
    <!-- BEGIN FORM-->
    <form action="{% url 'vista_editar_departamento' departamento.id %}" class="horizontal-form"  method="POST" >
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <div class="portlet-body form">
              <div class="alert alert-danger display-hide" style="display: none;">
                <button class="close" data-close="alert"></button> Tienes algunos errores. 
              </div>
              <div class="alert alert-success display-hide" style="display: none;">
                  <button class="close" data-close="alert"></button> Your form validation is successful! 
              </div>
              {% csrf_token %}
              <input type="hidden" name="form_condomino_crear" value="{{ departamento.id }}">
              <div class="row ">
                {% for field in user_form %}
                <div class="col-md-6">
                  <div class="form-group {% if field.errors %}has-error{% endif %}">
                    <label class="control-label">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label><br>
                    {{ field }}
                    <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                  </div>
                </div>
                <!--/span-->
                {% endfor %}
              </div>
              <h3>Datos del usuario</h3><hr>
              <div class="row ">
                {% for field in user_profile_form %}
                <div class="col-md-6">
                  <div class="form-group {% if field.errors %}has-error{% endif %}">
                    <label class="control-label">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                    {{ field }}
                    <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                  </div>
                </div>
                <!--/span-->
                {% endfor %}
              </div>
              <!--/row-->
              <h3>Propiedades del usuario</h3><hr>
                {% for field in usuario_departamento_condomino_form %}
                {% if not forloop.counter|divisibleby:2 %}
                <div class="row">
                    {% endif %}
                  <div class="col-md-6">
                    <div class="form-group {% if field.errors %}has-error{% endif %}">
                      <label class="control-label col-md-5">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                      <div class="col-md-7">
                        {{ field }}
                       <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                      </div>
                    </div>
                  </div>
                  <!--/span-->
                    {% if forloop.counter|divisibleby:2 or forloop.last %}
                </div>
                    {% endif %}
                {% endfor %}
              <!--/row-->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-outline dark">Cerrar</button>
        <button type="submit" class="btn green">Guardar</button>
      </div>
    </form>
    <!-- END FORM-->
  </div>
  <!-- END MODAL RESPONSIVE -->
  <!-- BEGIN MODAL RESPONSIVE -->
  <div id="modal_condomino_seleccionar" class="modal fade" tabindex="-1" data-width="800">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        <h4 class="modal-title">Seleccionar nuevo condómino</h4>
    </div>
    <!-- BEGIN FORM-->
    <form action="{% url 'vista_departamento_crear_usuariodepartamento' %}" class="horizontal-form"  method="POST" >
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12">
            <div class="portlet-body form">
              <div class="form-body">
                <div class="alert alert-danger display-hide" style="display: none;">
                  <button class="close" data-close="alert"></button> Tienes algunos errores. 
                </div>
                <div class="alert alert-success display-hide" style="display: none;">
                    <button class="close" data-close="alert"></button> Your form validation is successful! 
                </div>
                {% csrf_token %}
                <input type="hidden" name="id_departamento" value="{{ departamento.id }}">
                  {% for field in usuario_departamento_form %}
                    {% if not forloop.counter|divisibleby:2 %}
                <div class="row">
                    {% endif %}
                  <div class="col-md-6">
                    <div class="form-group {% if field.errors %}has-error{% endif %}">
                      <label class="control-label col-md-5">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                      <div class="col-md-7">
                        {{ field }}
                       <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                      </div>
                    </div>
                  </div>
                  <!--/span-->
                    {% if forloop.counter|divisibleby:2 or forloop.last %}
                </div>
                    {% endif %}
                  {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" data-dismiss="modal" class="btn btn-outline dark">Cerrar</button>
        <button type="submit" class="btn green">Seleccionar</button>
      </div>
    </form>
    <!-- END FORM-->
  </div>
  <!-- END MODAL RESPONSIVE -->
  <div class="portlet light bordered">
    <div class="portlet-title tabbable-line">
      <div class="caption">
          <i class="icon-pin font-yellow-lemon"></i>
          <span class="caption-subject bold font-yellow-lemon uppercase">EDITAR DEPARTAMENTO </span>
      </div>
    </div>
    <div class="portlet-body form">
      <div class="tab-content search-page search-content-2">
        <div class="row">
          <form role="form"  action="{% url 'vista_editar_departamento' departamento.id %}" class="form-horizontal" method="POST" >
            <div class="col-sm-12">
              {% csrf_token %}
              <div class="form-body">
                <div class="alert alert-danger display-hide" style="display: none;">
                  <button class="close" data-close="alert"></button> Tienes algunos errores. 
                </div>
                <div class="alert alert-success display-hide" style="display: none;">
                    <button class="close" data-close="alert"></button> Your form validation is successful! 
                </div>
                {% for field in departamento_form %}
                  {% if not forloop.counter|divisibleby:2 %}
                <div class="row">
                  {% endif %}
                  <div class="col-md-6">
                    <div class="form-group {% if field.errors %}has-error{% endif %}">
                      <label class="control-label col-md-3">{{ field.label|striptags }} {% if field.field.required %}*{% endif %}</label>
                      <div class="col-md-9">
                        {{ field }}
                        <span id="url-error" class="help-block help-block-error">{{ field.errors|striptags }}</span>
                      </div>
                    </div>
                  </div>
                  {% if  forloop.counter|divisibleby:2 or forloop.last %}
                </div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <div class="col-md-12 ">
              <div class="pull-right">
                <button type="submit" class="btn btn-success uppercase">ACTUALIZAR DEPARTAMENTO</button>  
              </div>
            </div>
          </form>
          <div>
            <span class="lead" >Condóminos</span>
            <div class="btn-toolbar">
              <a class="btn btn-sm green pull-right" data-toggle="modal" href="#modal_condomino">
                Crear nuevo condómino
                <i class="fa fa-plus"></i>
              </a>
              <a class="btn btn-sm green pull-right " data-toggle="modal" href="#modal_condomino_seleccionar">
                Seleccionar condómino
                <i class="fa fa-plus"></i>
              </a>
            </div>
          </div>
          <hr>
          <table class="table table-striped table-bordered table-hover" id="sample_1">
            <thead>
              <tr>
                <th>Nombre </th>
                <th>Correo </th>
                <th>Telefono(s)</th>
                <th>Correo</th>
                <th>Accion</th>
              </tr>
            </thead>
            <tbody>
              {% if departamento.usuariodepartamento_set.all  %}
                {% for usuariodepartamento in departamento.usuariodepartamento_set.all %} 
              <tr class="odd ">
                <td>{{ usuariodepartamento.usuario.first_name }} {{ usuariodepartamento.usuario.last_name }}</td>
                <td>{{ usuariodepartamento.usuario.username }}</td>
                <td>{{ usuariodepartamento.usuario.username }}</td>
                <td>{{ usuariodepartamento.usuario.username }}</td>
                <td class="text-center">
                  <a href="{% url 'vista_editar_departamento' departamento.id %}?editar_condomino_id={{ usuariodepartamento.usuario.id }}" class="btn btn-sm green">
                    <i class="fa fa-edit"></i>  Editar
                  </a>
                  <form action="{% url 'vista_departamento_quitar_usuariodepartamento' %}" method="POST" >
                    {% csrf_token %}
                    <input type="hidden" name="id_departamento" value="{{ departamento.id }}">
                    <input type="hidden" name="id_usuariodepartamento" value="{{ usuariodepartamento.id }}">
                    <button type="submit" class="btn btn-sm btn-danger"><i class="fa fa-close"></i> Quitar</button>
                  </form>
                </td>
              </tr>
                {% endfor %}
              {% else %}
              <tr>
                  <td colspan="5">No se encontraron codóminos en este departamento.</td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block javascript %}
<!-- BEGIN PAGE LEVEL PLUGINS -->
  <script src="{{ STATIC_PREFIX }}assets/global/scripts/datatable.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/pages/scripts/ui-extended-modals.js"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
  <script src="{{ STATIC_PREFIX }}js/apps/directorio/directorio.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script>
jQuery(document).ready(function() {   
  {% if messages %}
      {% for message in messages %}
      toastr["{{ message.tags }}"]("{{ message|safe }}", "Mensaje");
      {% endfor %}
      {% if message.extra_tags == 'error_crear_usuario' %}
      toastr["{{ message.tags }}"]("asdasdasdas", "Mensaje");
      {% endif %}
  {% endif %}
  {% if error_crear_condomino %}
  $('#modal_condomino').modal('show'); 
  {% endif %}
  {% if error_editar_condomino or request.GET.editar_condomino_id%}
  $('#modal_condomino_editar').modal('show'); 
  {% endif %}
});
</script>
{% endblock %}